---
author: Kolyn090
banner: /static/img/2-softwares/nonogram-solver/talpia.png
categories: Log
custom_class: custom-page-content
date: 2025-01-08 19:00:00 -0500
layout: post
permalink: /software-nonogram-solver-add-draw/
title: Personal Log - Adding 'Draw' Feature
---


**This article, completely original, is copyrighted by its author, me. Please do not reproduce it.**


**本文为原创作品，作者 Kolyn090 拥有其著作权，受法律保护。严禁复制、转载、仿冒或以任何形式使用。**


Category: Log


Prerequisite: Basic Python


## Introduction
[Nonogram Solver](https://github.com/Kolyn090/nonogram.git) is a puzzle solver for [Nonogram](https://en.wikipedia.org/wiki/Nonogram) I made a while ago. Its algorithm is based on [fedimser](https://github.com/fedimser)'s [nonolab](https://github.com/fedimser/nonolab). Its UI code is based on another project of mine, you can find it on [Linkedin](https://www.linkedin.com/posts/kolyn090_creating-a-pixel-art-editor-i-write-tutorials-activity-7170246292672090112-UR0A?utm_source=share&utm_medium=member_desktop).


Nonogram Solver currently supports solving Nonogram puzzles, importing puzzles, and exporting puzzles. **Most importantly, importing puzzles from images.** Today I will be working on 'Drawing a Puzzle' feature.


## Start working
# Step 1
The first thing I am going to do is to review my current project. Here is the project hierarchy of my current project:
{% highlight shell %}
src
|_ image_recognition
|_ solve
|_ ui
|_ util
{% endhighlight %}


Here, `ui` contains all front end code. `image_recognition` takes in a screenshot and attempts to find the puzzle (it's actually just two matrices). `solve` solves the given puzzle if it's valid. `util` contains all utility functions.


# Step 2
I like to separate things this way to keep them stay organized. Now let's think how 'Draw a Puzzle' should fit into this system. First of all, I think it deserves its own folder.


{% highlight shell %}
src
|_ draw
|_ image_recognition
|_ solve
|_ ui
|_ util
{% endhighlight %}


Also, since its functionality is drawing, there will be some connections with the UI components. So this time I cannot treat it the same as `solve` nor `image_recognition`. Create `draw_mode` under `ui`.


{% highlight shell %}
src
|_ draw
|_ image_recognition
|_ solve
|_ ui
    |_ draw_mode
|_ util
{% endhighlight %}


# Step 3
Think about this, the problem can be simplified as <u>given a binary image, return a Nonogram puzzle (two matrices).</u> So the next thing I should do is actually quite easy: Take a binary image and try to convert it to a more familiar data. 


Let's see this example:


![binary](/static/img/2-softwares/nonogram-solver/binary.png)


For now, let me convert this to ASCII Art.


{% highlight python %}
import cv2
from src.solve.solution import EMPTY_MARKER, FILL_MARKER


class Binary_To_Ascii_Art:
    def __init__(self, binary_image):
        self.EMPTY_MARKER = EMPTY_MARKER
        self.FILL_MARKER = FILL_MARKER
        height, width = binary_image.shape

        self.lists = []
        # Iterate through each pixel
        for y in range(height):  # Rows
            row = []
            for x in range(width):  # Columns
                pixel_value = binary_image[y, x]
                # Check if the pixel is black or white
                if pixel_value == 255:
                    row.append(EMPTY_MARKER)
                elif pixel_value == 0:
                    row.append(FILL_MARKER)
            self.lists.append(row)


if __name__ == '__main__':
    binary_image = cv2.imread('binary.png', cv2.THRESH_BINARY)
    btaa = Binary_To_Ascii_Art(binary_image)
    for lst in btaa.lists:
        print(''.join(lst))
{% endhighlight %}


I got


{% highlight shell %}
☐☐☐☒☒☒☒☒☒☐☐☐☐☐
☐☐☒☐☐☐☐☐☐☒☐☐☐☐
☐☒☐☒☒☒☒☒☒☐☒☐☐☐
☐☒☒☒☒☒☒☒☒☒☐☒☐☐
☐☒☒☒☒☐☒☒☒☒☒☐☒☐
☐☒☒☒☒☐☒☒☒☒☒☒☒☒
☒☐☐☐☒☒☒☒☒☒☒☒☒☒
☒☒☒☐☒☒☒☒☒☒☒☒☒☒
☐☒☒☒☒☒☒☒☒☒☒☒☒☒
☐☐☒☐☒☐☒☒☒☒☒☒☒☒
☐☐☒☒☒☒☒☒☒☒☒☒☒☒
☐☐☐☒☒☒☒☒☒☒☒☒☒☐
☐☐☐☐☒☐☒☒☒☐☒☒☐☐
☐☐☐☐☐☒☒☒☒☒☒☐☐☐
{% endhighlight %}

# Step 4
I know nonolab has drawing feature. It takes in an ASCII Art like above and returns a `.non` file, which is the file format that nonolab uses to save a Nonogram puzzle. 


Save the ASCII Art into `talpia.txt` and run `Main.java`. Type `create talpia.txt`, I got
{% highlight shell %}
width 14
height 14

columns
2
4,2
1,3,4
1,4,1,2
1,11
1,2,3,2,1
1,12
1,12
1,12
1,9,1
1,10
1,8
8
6
rows
6
1,1
1,6,1
9,1
4,5,1
4,8
1,10
3,10
13
1,1,8
12
10
1,3,2
6


goal "0000001100000000111101100000010111011110001011110010110010111111111110101100111011011011111111111110111111111111101111111111110101111111110100101111111111000101111111100000111111110000000111111000"
{% endhighlight %}


Now I import this file into my Nonogram Solver, I got


![talpia](/static/img/2-softwares/nonogram-solver/talpia.png)


# Step 5
Next, I want to analyze fedimser's code. In `Main.java`, I found


{% highlight java %}
private static void create(String fileName) {
        File file = new File(fileName);
        NonogramSolution sol=null;
        try {
            String ascii = Files.lines(file.toPath()).collect(Collectors.joining("\n"));
            sol = new NonogramSolution(ascii);
        } catch (IOException e) {
            e.printStackTrace();
            return;
        }

        Path dir = file.getParentFile().toPath();
        String name = file.getName();
        if (name.substring(name.length()-4).equals(".txt")) {
            name = name.substring(0, name.length()-4);
        }

        try {
            sol.writeToFile(dir.resolve(name + ".non").toFile());
            System.out.println("Done!");
        } catch (IOException ex) {
            ex.printStackTrace();
            return;
        }

        // Solve pictures.
        try{
            NonogramDrawer.drawAll(sol, dir, name);
        } catch (IOException e) {
            e.printStackTrace();
        }

        check(dir.resolve(name + ".non").toString());
    }
{% endhighlight %}


